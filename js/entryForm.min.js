const dropArea=document.getElementById("drop-area"),inputFile=document.getElementById("input-file"),imgView=document.getElementById("img-view");function uploadImage(){let e=URL.createObjectURL(inputFile.files[0]);imgView.style.backgroundImage=`url(${e})`,imgView.textContent="",imgView.style.border=0}inputFile.addEventListener("change",uploadImage),dropArea.addEventListener("dragover",(function(e){e.preventDefault()})),dropArea.addEventListener("drop",(function(e){e.preventDefault(),inputFile.files=e.dataTransfer.files,uploadImage()})),document.addEventListener("DOMContentLoaded",(async()=>{const e=document.querySelector("form"),t=e.querySelector(".submit-button"),i=document.querySelector(".form-header h2"),n=new URLSearchParams(window.location.search).get("id"),a=!!n;let r=null;if(a){i.textContent="Edit Recipe",t.textContent="Update Recipe";try{const e=await fetch(`/api/recipes/${n}`,{credentials:"include"});if(!e.ok)return alert("Failed to load recipe. Redirecting to catalog..."),void(window.location.href="/catalog");const t=await e.json();if(t.success&&t.data.recipe){r=t.data.recipe,document.getElementById("recipe-name").value=r.recipeName,document.getElementById("description").value=r.description,document.getElementById("ingredients").value=r.ingredients,document.getElementById("directions").value=r.directions;const e=document.getElementById("img-view");e.style.backgroundImage=`url(${r.imagePath})`,e.textContent="",e.style.border=0}}catch(e){return console.error("Error loading recipe:",e),alert("Failed to load recipe. Redirecting to catalog..."),void(window.location.href="/catalog")}}e.addEventListener("submit",(async e=>{e.preventDefault();const i=document.getElementById("recipe-name").value.trim(),r=document.getElementById("description").value.trim(),o=document.getElementById("ingredients").value.trim(),d=document.getElementById("directions").value.trim(),l=inputFile.files[0];if(i&&r&&o&&d)if(a||l){if(l){if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(l.type))return void alert("Only JPEG, PNG, and WebP images are allowed!");const e=5242880;if(l.size>e)return void alert("Image size must be less than 5MB!")}t.disabled=!0,t.textContent=a?"Updating...":"Submitting...";try{const e=new FormData;e.append("recipeName",i),e.append("description",r),e.append("ingredients",o),e.append("directions",d),l&&e.append("image",l);const c=a?`/api/recipes/${n}`:"/api/recipes",s=a?"PUT":"POST",u=await fetch(c,{method:s,credentials:"include",body:e}),p=await u.json();if(u.ok&&p.success)alert(a?"Recipe updated successfully!":"Recipe created successfully!"),window.location.href=a?`/details?id=${n}`:"/catalog";else{if(401===u.status)alert("You must be logged in!"),window.location.href="/sign-in";else if(403===u.status)alert("You can only edit your own recipes!"),window.location.href=`/details?id=${n}`;else{const e=p.error?.message||`Failed to ${a?"update":"create"} recipe. Please try again.`;alert(e)}t.disabled=!1,t.textContent=a?"Update Recipe":"Submit Recipe"}}catch(e){console.error((a?"Update":"Create")+" recipe error:",e),alert("Network error. Please check your connection and try again."),t.disabled=!1,t.textContent=a?"Update Recipe":"Submit Recipe"}}else alert("Please upload a recipe image!");else alert("Please fill in all required fields!")}))}));