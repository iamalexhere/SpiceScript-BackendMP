let currentUser=null;async function fetchRecipes(){try{const e=await fetch("/api/recipes",{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch recipes");const t=await e.json();return t.success&&t.data.recipes||[]}catch(e){return console.error("Error fetching recipes:",e),alert("Failed to load recipes. Please refresh the page."),[]}}async function checkAuth(){try{const e=await fetch("/api/auth/me",{credentials:"include"});if(e.ok){const t=await e.json();if(t.success)return currentUser=t.data.user,!0}return currentUser=null,!1}catch(e){return console.error("Error checking auth:",e),currentUser=null,!1}}function renderCatalog(e){const t=document.getElementById("catalog"),n=document.querySelector(".search-message");if(!e||0===e.length)return n.innerHTML='\n            <h2 class="no-recipes-title">No recipes found!</h2>\n            <p class="no-recipes-text">Be the first to add one!</p>\n        ',void(t.innerHTML="");n.innerHTML="";const r=e.map((e=>`\n        <div class="card clickable" data-recipe-id="${e.id}">\n            <img src="${e.imagePath||"/images/default-recipe.jpg"}" class="image-container" alt="${e.recipeName}">\n            <div class="card-inner-container">\n                <h4><b>${e.recipeName}</b></h4>\n                <p>${e.description}</p>\n                <small class="recipe-author">by ${e.authorName||"Anonymous"}</small>\n            </div>\n        </div>\n    `)).join("");t.innerHTML=r;document.querySelectorAll(".card").forEach((e=>{e.addEventListener("click",(()=>{const t=e.getAttribute("data-recipe-id");window.location.href=`/details?id=${t}`}))}))}function updateNavButtons(){const e=document.getElementById("signInBtn"),t=document.getElementById("signOutBtn"),n=document.getElementById("createRecipeBtn");currentUser?(e.classList.add("hidden"),t.classList.remove("hidden"),n.classList.remove("hidden")):(e.classList.remove("hidden"),t.classList.add("hidden"),n.classList.add("hidden"))}async function handleSignOut(){try{(await fetch("/api/auth/signout",{method:"POST",credentials:"include"})).ok?(currentUser=null,updateNavButtons(),alert("Signed out successfully!"),await loadPage()):alert("Sign out failed. Please try again.")}catch(e){console.error("Sign out error:",e),alert("Network error during sign out.")}}async function loadPage(){await checkAuth(),updateNavButtons();const e=await fetchRecipes();renderCatalog(e);document.querySelector(".search-input").addEventListener("input",(t=>{const n=t.target.value;renderCatalog(e.filter((e=>e.recipeName.toLowerCase().includes(n))))}))}document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("signOutBtn");e&&e.addEventListener("click",handleSignOut),loadPage()}));